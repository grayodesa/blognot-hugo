---
title: Как вставить видео в блог
author: Gray
type: posts
date: 2010-05-14T05:44:20+00:00
excerpt:
url: /10283
dsq_thread_id:
  - 95478698
esml_socialcount_LAST_UPDATED:
  - 1497261844
essb_cache_expire:
  - 1614130529
categories:
  - Uncategorized

---







<img src="https://i2.wp.com/forumimg.net/blog/play.jpg?resize=150%2C150" width="150" height="150" align="left" data-recalc-dims="1" /> 

Честно говоря, довольно долго совсем не&nbsp;задумывался о&nbsp;вставке видео в&nbsp;посты на&nbsp;блоге&nbsp;&mdash; казалось&nbsp;бы, всё вопросы предельно упрощены, загружаешь ролик на&nbsp;YouTube или Яндекс.Видео (я&nbsp;предпочитаю второе, поскольку там нет временных ограничений), немного ждешь обработки и&nbsp;получаешь <nobr>html-код</nobr> для вставки. Но&nbsp;вот опубликовал давеча видео с&nbsp;<nobr>РТ-Коня</nobr> и&nbsp;столкнулся сразу с&nbsp;двумя вопросами.

<nobr>Во-первых</nobr>, видеоролик такой длительности&nbsp;&mdash; а&nbsp;там получилось 76&nbsp;минут,&nbsp;&mdash; неизбежно получается очень большой. В&nbsp;данном случае, даже очень ускоренно сохраненный в&nbsp;iMovie в&nbsp;мобильном варианте (450*255 пикселов), он&nbsp;получился размером в&nbsp;550&nbsp;мегабайт. Если&nbsp;бы я&nbsp;ориентировался на&nbsp;640&#215;360, то&nbsp;пришлось&nbsp;бы придумывать, куда девать 950&nbsp;мегабайт одним куском. Немало, правда? При этом он&nbsp;неизбежно получается некачественным, хотя изначально снимался в&nbsp;FullHD.

<nobr>Во-вторых</nobr>, он&nbsp;теряет аудиторию. Мне сразу начали жаловаться, что его невозможно посмотреть в&nbsp;iPad, что не&nbsp;у&nbsp;всех хорошая скорость до&nbsp;Яндекс.Видео&nbsp;&mdash; короче, нехорошо.

Впрочем, оказалось, что технологии, снабдив нас возможностями снимать тяжелые ролики, не&nbsp;забыли придумать и&nbsp;способы эти ролики показывать. Так что, после некоторых изысканий, я&nbsp;нашел вполне неплохое решение, которое позволит в&nbsp;подобных случаях угодить практически всем пользователям.

Как легко догадаться, решение состоит в&nbsp;использовании возможностей HTML5, а&nbsp;конкретно тега <video>. Для тех, кто не&nbsp;очень в&nbsp;курсе, поясню&nbsp;&mdash; стандарт HTML5, который, правда, еще не&nbsp;стандарт, но&nbsp;его элементы начинают поддерживаться браузерами, позволяет вставлять видеоролик в&nbsp;страницу так&nbsp;же легко, как и&nbsp;картинку&nbsp;&mdash; достаточно указать конструкцию вида <video src=&#187;path/to/file&#187; controls/> и&nbsp;файл будет вставлен, снабжен встроенным в&nbsp;браузер плеером и&nbsp;так далее.

На&nbsp;сегодня именно этот тег HTML5 поддерживается в&nbsp;Safari, Google Chrome, Firefox, Opera, а также встроенными браузерами на&nbsp;iPhone/iPad и&nbsp;Android. Internet Explorer пока такого чуда не&nbsp;умеет (обещает уметь в&nbsp;IE9), но&nbsp;это полбеды. Вторая половина беды заключается в&nbsp;том, что Safari, Chrome и&nbsp;мобильные браузеры требуют, чтобы в&nbsp;src тега был указан файл, закодированный в&nbsp;стандарте H.264 с&nbsp;аудиокодеком AAC, а&nbsp;Firefox и&nbsp;Opera требуют использовать видеокодек Theora и&nbsp;аудиокодек Vorbis, которые хороши тем, что <nobr>open-source</nobr> и&nbsp;не&nbsp;требуют лицензирования, в&nbsp;отличие от&nbsp;H.264. И, если Chrome, как самый молодой, имеет поддержку обоих стандартов, то&nbsp;это исключение. Так что вебмастерам, желающим угодить совершенно всем своим пользователям, стоит понимать, что это желание выльется в&nbsp;необходимость кодировать и&nbsp;хранить два варианта ролика (как минимум). Если вас это не&nbsp;пугает, то&nbsp;давайте разбираться дальше.

Особых технических сложностей в&nbsp;процессе нет. Предположим, у&nbsp;вас есть видеофайл в&nbsp;<nobr>каком-то</nobr> общепринятом формате. Вначале сконвертируем его в&nbsp;OGG (это контейнер, содержащий файл формата Theora/Vorbis). Очень просто это сделать&hellip; в&nbsp;Firefox. Для него есть замечательное расширение [Firefogg][1], которое прямо в&nbsp;окне браузера позволяет перекодировать ролик.

Возможностей для настройки там масса, можете покопаться, но&nbsp;умолчальные достаточно хороши и&nbsp;я&nbsp;бы посоветовал их&nbsp;не&nbsp;менять&nbsp;&mdash; если только вы&nbsp;хорошо разбираетесь в&nbsp;кодеках и&nbsp;знаете, что делаете. Выбираете исходный файл, нажимаете &laquo;Save OGG&raquo;, вводите желаемое имя итогового файла и&nbsp;оставляете плагин работать.

<img src="https://i0.wp.com/forumimg.net/blog//Firefogg_-_Make_Ogg_Video_in_your_Browser-20100513-012036.png?w=740" alt="Firefogg%20-%20Make%20Ogg%20Video%20in%20your%20Browser-5" data-recalc-dims="1" /> 

Если вы&nbsp;поклонник командной строки, то&nbsp;к&nbsp;вашим услугам <nobr>кросс-платформенный</nobr> конвертер [ffmpeg2theora][2].

Итак, у&nbsp;вас есть <nobr>ogv-файл</nobr>. Теперь надо получить аналогичный в&nbsp;MP4.

Самое простое&nbsp;&mdash; воспользоваться бесплатной <nobr>кросс-платформенной</nobr> программой под названием [Handbrake][3]. Указываете ей&nbsp;исходный файл, из&nbsp;боковой панели выбираете нужный профиль, не&nbsp;забудьте поставить галочку в&nbsp;поле <nobr>&laquo;Web-optimized&raquo;</nobr> и&nbsp;нажимаете на&nbsp;старт. <nobr>Опять-таки</nobr>&nbsp;&mdash; если вы&nbsp;специалист, можете покопаться в&nbsp;настройках кодеков, но&nbsp;в&nbsp;большинстве случаев дефолтные настройки работают прекрасно.

<img src="https://i1.wp.com/forumimg.net/blog//HandBrake-20100513-012919.png?w=740" alt="HandBrake" data-recalc-dims="1" /> 

В&nbsp;результате у&nbsp;вас имеется два ролика, помимо исходного. Почти все готово. Почти&nbsp;&mdash; потому что мы&nbsp;чуть не&nbsp;забыли о&nbsp;пользователях Internet Explorer, браузер которых в&nbsp;принципе не&nbsp;поймет тега <video> и&nbsp;проигнорирует его. Чтобы их&nbsp;все&nbsp;же не&nbsp;обделить, советую воспользоваться любым из&nbsp;видеохостингов&nbsp;&mdash; раз уж&nbsp;их&nbsp;браузер не&nbsp;играет видео сам, они будут смотреть его через Flash. Загружаете ролик и&nbsp;берете оттуда код для вставки на&nbsp;сайт. Вот теперь готово опять почти всё&nbsp;&mdash; поскольку ролики надо <nobr>куда-то</nobr> загрузить.

Если размер роликов таков, что вы&nbsp;не&nbsp;можете их&nbsp;просто залить на&nbsp;видеосервис&nbsp;&mdash; а&nbsp;мы&nbsp;с&nbsp;этого и&nbsp;начали,-то я&nbsp;бы трижды подумал перед попыткой загрузить их&nbsp;на&nbsp;<nobr>shared-хостинг</nobr>, где лежит ваш блог, и&nbsp;даже на&nbsp;собственный сервер. Видео с&nbsp;<nobr>РТ-Коня</nobr> за&nbsp;два дня посмотрели 1500 человек, а&nbsp;размер файла, напомню, 550&nbsp;мегабайт. Посчитайте сами&nbsp;&mdash; кроме <nobr>пол-терабайта</nobr> трафика, стоит учесть нагрузку на&nbsp;сервер, которая вполне ощутима даже для выделенного сервера. Я&nbsp;бы посоветовал для таких случаев посмотреть в&nbsp;сторону сервисов облачного хранения&nbsp;&mdash; например, на&nbsp;Amazon S3, куда я&nbsp;собираюсь положить сконвертированные файлы этого ролика. Они умеют держать такую нагрузку и&nbsp;обходятся довольно дешево.

Однако будем считать, что файлы загружены, пути к&nbsp;ним имеются и&nbsp;теперь уж&nbsp;точно все готово. Осталась ерунда&nbsp;&mdash; написать следующий код:

<pre><span style="font-family: Times; white-space: normal;">

<pre style="word-wrap: break-word; white-space: pre-wrap;">&lt;video width="640" height="360" controls preload="none"&gt;
&lt;source src="path/to/file.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'&gt;&lt;/source&gt;
&lt;source src="path/to/file.ogv" type='video/ogg; codecs="theora, vorbis"'&gt;&lt;/source&gt;
&lt;object width="640" height="360"&gt;&lt;param name="video" value="http://static.video.yandex.ru/lite/gray7400/xxxxxxxx"/&gt;&lt;param name="allowFullScreen" value="true"/&gt;&lt;param name="scale" value="noscale"/&gt;&lt;embed src="http://static.video.yandex.ru/lite/gray7400/xxxxxxxxx/" type="application/x-shockwave-flash" width="640" height="360" allowFullScreen="true" scale="noscale"&gt; &lt;/embed&gt;&lt;/object&gt;
&lt;/video&gt;</pre>


<p>
  </span>
</p>


<p>
  Всё работает довольно просто. Дело в&nbsp;том, что, встретив тег <video>, браузер начинает искать внутри него источник, формат которого он&nbsp;умеет воспроизвести. Первый такой файл&nbsp;&mdash; он&nbsp;определяется по&nbsp;типу контейнера и&nbsp;кодекам, которые указаны в&nbsp;type и&nbsp;codecs тега source соответственно,&nbsp;&mdash; и&nbsp;воспроизводится, а&nbsp;остальные оставляются без проверки. Поэтому Safari и&nbsp;Chrome остановятся на&nbsp;первом файле (кстати, mp4 обязательно указывать первым, иначе может сломаться воспроизведение в&nbsp;iPhone), Firefox пропустит первый файл и&nbsp;найдет второй, а&nbsp;IE&nbsp;вообще не&nbsp;обратит внимания на&nbsp;незнакомые ему теги <video> и <content>, но&nbsp;увидит <object> и&nbsp;выведет <nobr>флэш-плеер</nobr> видеосервиса. Все довольны и&nbsp;счастливы.
</p>


<p>
  Я&nbsp;собираюсь именно таким способом за&nbsp;следующие пару дней все&nbsp;же переконвертировать видео с&nbsp;<nobr>РТ-Коня</nobr> и&nbsp;выложить&nbsp;&mdash; так что заодно и&nbsp;проверим, как оно работает под действительно немалой нагрузкой.
</p>

 [1]: http://firefogg.org/
 [2]: http://v2v.cc/~j/ffmpeg2theora/download.html
 [3]: http://handbrake.fr/