---
title: "Поменяем систему комментариев"
date: 2021-04-20T01:04:07+03:00
draft: false
tags:
  - блог
  - hugo  
url: /60613/

---
В предыдущей заметке на тему переезда на Hugo всем блогом я объяснял, почему решил заодно опробовать новую внешнюю систему комментариев Replybox — она очень немного весит, имеет возможности авторизации и так далее. Впрочем, уже за пару дней эксплуатации у неё выявились недостатки, несовместимые с жизнью.

Самый первый недостаток выявили сразу — оказывается, стремление Apple к победе privacy уже сделало не очень удобным использование таких систем, поскольку по умолчанию им требуется доступ к сторонним кукам, а Safari его по умолчанию блокирует. Впрочем, с этим бы я еще пожил.

Неприятнее оказалось другое — система, красиво описывая, как она интегрирована с Wordpress, на самом деле просто быстро перелила себе все комментарии, но новые комментарии отдавать Wordpress-у не собиралась. В связи с чем мне очень неудобно перед теми, кто комментировал предыдущую запись — их комментарии никак не перенести обратно. Я могу только придумать их перепостить здесь и ответить так же, что и сделано ниже.

Как несложно догадаться, никакого экспорта система не предлагает. Более того, она и не предлагает никакого способа использовать данные — нет ни счетчиков, ни виджета последних комментариев. И она еще и глючная — буквально за несколько дней она насчитала мне 15 тысяч хитов и я даже не понимаю, что она считала — неужели количество показов каждого комментария? Если учесть, что она платная, причем именно по показам, выглядит совсем плохо.

В общем, в итоге я занялся пристальным изучением творения того же Umputun — то есть системы комментариев [remark42](https://remark42.com). Легко догадаться, что именно она и живет теперь здесь. Все приведенные недостатки у неё отсутствуют, а стоимость держания дополнительного контейнера равна минимальному тарифу у Replybox, к тому же я вполне могу и эту сумму сэкономить.

А ниже — те комментарии, которые остались в Replybox.

> googhalava: 
> Да, скорость загрузки впечатляет.  
> А вы не встречали способа писать посты в Hugo с телефона в процессе поиска?
Вообще, нет способа писать посты в hugo. Посты писать надо во что-то, откуда hugo возьмет базу. В принципе, написать пост в гитхабе можно и с телефона. Можно попробовать прикрутить что-то типа netlify cms, которая умеет делать маркдаун-посты в выбранный репозиторий. С другой стороны, поскольку я давно перестал писать по 10-20 постов в день в блоге, то с телефона я скорее напишу в твиттер, а сюда можно и более основательно подготовиться.

> googhalava:
> Я понимаю, как Hugo работает. Вопрос в том, как лучше организовать процесс написания, если ты пишешь не один и другие люди не готовы писать посты в Markdown.
Я честно не знаю, как организовать процесс для нескольких человек, поскольку отправка постов несколькими человеками почти одновременно выглядит в данном случае странно. Живым людям можно вручить текстовый редактор типа ulysses или iAwriter, чтобы писать в маркдауне.

> Alexey Shevchenko:  
> действительно быстро! Но есть вопросы:
> 1. Для СЕО, есть возможность генерировать читабельные URL, вместо: https://new1.blognot.co/60602/ ? Типа https://new1.blognot.co/60602/hugo-blog-kak-sdelat
> 2. Ответить на комментарий удалось только после отключение блокировки third-party cookies (Brave browser). Не круто, но понятно что удобно и быстро. Подозреваю в firefox и safari может быть такая же проблема.

1. Да, тут можно хоть руками задать, хоть из шаблона генерировать, я специально прописываю так, чтобы сохранить совместимость с вордпрессом.
2. В Safari да, есть такая проблема. Но вообще любая внешняя система комментариев столкнется с этим, разве что кроме того же ремарка, который можно поставить на поддомен и тогда его куки будут first-party.

> zabey_ded :_ В кэш нужно уметь, он подходит где вы контролите всё. Темы лишены этого знания. Если тема без параметров, реализовать кэш просто, но никто не хочет их юзать, ибо нет ничего. Сложные темы настраиваются гибче, их скорость меньше, прирост от кеша большой, но и добавить его сложнее. А добавив, автоматически сильно усложняется допилка+понимание работы для окружающих. Если это просто (заменить всё на partialCached), почему никто этого не делает массово?
> Это чем-то похоже на дебаг неиспользуемого CSS в тулзах хрома. Полезно, но многие не понимают как оно работает и лезут. Если начать удалять всё неиспользуемое, можно поломать стили и не заметить. Тот же принцип: если кэш работал для вашего сайта, где все параметры одинаковы для всех страниц, это не значит, что оно заработает для других людей, которые используют более специфичные конфиги.
> О cache potential: 100 присваивается частям, которые не менялись при конкретной генерации для всех страниц. Эта система может ошибаться как детектор неиспользуемого CSS. Если сайдбар всегда справа, с одинаковым контентом, то вам покажет 100. Это не значит, что его можно закэшировать в 100 процентах случаев. Вот кто-то добавил новый виджет для конкретной секции сайта и всё, кэш ломается, потому что некоторые страницы теперь используют другой набор входных параметров. Это значение не константа, один раз проверил работает только если вы вообще больше к теме не притрагиваетесь и не используете её параметры во front matter. Кажется, четырехкратное ускорение вы получили в том числе, что сломали фичи, которые не используете. Поэтому «люди, осилившие язык шаблонов очень гиковского движка, знают что делают» и таки отличаются от людей, научившихся делать темы для WordPress. По крайней мере, не трогают то, в чём не разбираются на 100 процентов. Я надеюсь. А ваш вредный совет может кому-то подарить несколько незабываемых часов и сообщений на форумах в духе ПАМАГИТЕ!11.
> Начать с Hugo легко, оптимизировать его под готовый сайт со множеством страниц — нужно время и знания. Я настоятельно советую потратить несколько дней на изучение того, как оно работает на уровне чтения важных страниц документации (в особенности, если являетесь представителем WordPress или древнего PHP сообщества, без обид). И ридми темы тоже почитать, если вы решили готовую использовать, а не свой шаблон накодить. Иначе вас ждёт множественное наступание на грабли в самых неожиданных местах.
> P.S. Чёрная иконка YouTube это так было задумано?
За причисление меня к представителям PHP сообщества, наверное, надо сказать спасибо, но я вообще не программист. Я не собираюсь разрабатывать темы для этого движка и, правя шаблоны для этого блога, преследую цель только исправить шаблоны для этого блога и добиться его публикации за время, немного меньшее 10-20 минут. Почему это так разгневало комментатора — не понимаю. Я же не бегаю по форумам с заявлениями «Криворукие гошники, вы вообще в состоянии представить себе, что в блоге может быть больше сотни записей?». Видимо, потому что знаю, что нет, не могут они себе такое представить. Впрочем, не в Go дело, конечно.

Ну вот, теперь примерно можно жить — я имею в виду комментарии и прочие украшения. Есть, конечно, что еще доделать. Так что не переключайтесь.