---
title: Умный дом вместо зоопарка
author: Gray
type: posts
date: 2021-01-17T09:25:00+00:00
url: /60121
featured_image: https://blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg

---

Я думаю, никому уже сейчас не надо рассказывать про концепцию умного дома, где большое количество устройств, в том числе традиционных, объединено в единую сеть и так же согласовано управляется. Для реализации этого подхода есть сразу несколько экосистем — HomeKit у Apple, Alexa в Amazon, Google Home понятно где и так далее. Правда, в наших условиях не всё так просто — большое большинство устройств рассчитано на английский язык при голосовом управлении, а интерфейсы — на западные образцы. К примеру, далеко не новый умный термостат Google Nest в наших условиях никуда особо не подключишь. 

У меня, впрочем, есть и другая проблема — поскольку интересоваться этим я стал давно и иногда покупал что-то полезное, совместимость этого всего оставляет желать лучшего. К примеру, с HomeKit у меня совместима только одна камера NetAtmo Welcome, а Weather Station от той же NetAtmo не совместима — когда я ее покупал, HomeKit только запускался и совместимость появилась в следующей модели. Есть видеодомофон от Ring, но он принципиально не будет работать с устройствами Apple — впрочем, есть колонка Echo с Alexa внутри. А есть еще колонки Sonos, которые вообще ни туда, ни сюда. И очень давно хочется это всё же подружить.

И вот совершенно случайно мне попалась заметка, где упоминался некий HomeBridge, причем именно как нечто, которое делает совместимым с HomeKit несовместимые устройства. Забегая вперед — да, действительно делает.

<a href="https://github.com/homebridge/homebridge" target="_blank" rel="noreferrer noopener">HomeBridge</a> — это небольшой сервер, который вы можете запустить в локальной сети, который выступает мостом для HomeKit. То есть к нему разными плагинами — а их немало, — подключаются устройства, типа того же домофона Ring, а он транслирует их в HomeKit API. iOS, правда, ругается на отсутствие сертификации, но исправно показывает необходимую информацию и даже понимает, что она означает — в смысле, использует её для сценариев автоматизации.

Для запуска сервера можно использовать любой компьютер — ну, понятно, что он должен быть постоянно включен, если вы хотите, чтобы это всё постоянно работало. Варианты есть для все платформы, я попробовал сразу три варианта.

Вариант с <a href="https://github.com/homebridge/homebridge/wiki/Install-Homebridge-on-Raspbian" target="_blank" rel="noreferrer noopener">Raspberry Pi</a> практически идеален для тех, у кого под рукой есть этот маленький компьютер. Я прямо не поверил простоте процесса — берете SD-карту, записываете на неё готовый образ, который скачиваете из репозитория, включаете Raspberry Pi и через некоторое время у вас в сети появляется готовый бридж, доступный через любой браузер. Может быть загвоздка, если у вас компьютер не может найти его в сети по имени homebridge.local, но в этом случае надо просто на роутере найти, какой ему IP выдали и сходить по нему.

Правда, мне он не очень понравился, поскольку у меня под рукой оказался еще самый первый Raspberry Pi (если точнее, второй, то есть Pi 1 Model B), и ему было откровенно тяжело запускаться и пережевывать все процессы. Установка первого плагина заняла минут десять и я решил не увлекаться, тем более, что температура процессора стабильно держалась на 45 градусах.

Вторым вариантом стал запуск сервера на моем NAS Synology. У меня модель DS-918+, где можно установить Docker, а на сайте <a href="https://github.com/oznu/docker-homebridge/wiki/Homebridge-on-Synology" target="_blank" rel="noreferrer noopener" title="https://github.com/oznu/docker-homebridge/wiki/Homebridge-on-Synology">описан</a> способ установки сервера именно таким образом. Долго расписывать не буду — мне этот вариант не понравился совсем, поскольку веб-интерфейс при этом отсутствует и все плагины приходится запускать через команды терминала. Но, если у вас уже есть NAS, то это в принципе хороший вариант, поскольку он все же включен постоянно.

Но я выбрал третий вариант — поскольку у меня прямо в доме работает несколько серверов, оставшихся после закрытия коворкинга (на одном бежит телефония и бухгалтерия, ведь компания-то работает, на другом развернул вебсервер с архивными проектами), то почему бы не использовать их? Тем более, что на одном сервере стоит гипервизор с виртуалками, отрезать кусок для еще одной виртуалки не проблема. В общем, самое долгое было поставить Ubuntu Server на эту виртуалку, а затем по <a href="https://github.com/homebridge/homebridge/wiki/Install-Homebridge-on-Debian-or-Ubuntu-Linux" target="_blank" rel="noreferrer noopener" title="https://github.com/homebridge/homebridge/wiki/Install-Homebridge-on-Debian-or-Ubuntu-Linux">еще одному мануалу</a> разворачивание HomeBridge заняло минут 5. <figure class="wp-block-image size-large is-style-default">

[<img data-attachment-id="60122" data-permalink="https://blognot.co/60121/homebridge-315f-2021-01-17-11-10-11" data-orig-file="https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?fit=2399%2C1277&ssl=1" data-orig-size="2399,1277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Homebridge-315F-2021-01-17-11-10-11" data-image-description="" data-medium-file="https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?fit=300%2C160&ssl=1" data-large-file="https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?fit=740%2C394&ssl=1" width="740" height="394" src="https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=740%2C394&#038;ssl=1" alt="" class="wp-image-60122" srcset="https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=1024%2C545&ssl=1 1024w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=300%2C160&ssl=1 300w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=768%2C409&ssl=1 768w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=1536%2C818&ssl=1 1536w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=2048%2C1090&ssl=1 2048w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?resize=800%2C426&ssl=1 800w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?w=1480&ssl=1 1480w, https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?w=2220&ssl=1 2220w" sizes="(max-width: 740px) 100vw, 740px" data-recalc-dims="1" />][1]</figure> 

Правда, подключение его к HomeKit отняло немало времени, но это мои локальные заморочки — в отличие от бытового Wi-Fi, мой Cisco довольно строго относится к поползновениям устройств куда-то ходить на непривычные порты, а найти, какие именно это порты, надо уметь — ведь производители упрощают процесс установки до &#171;купи и включи&#187;. 

Но, когда заморочки Wi-Fi были побеждены, получилась красота. Ring без вопросов стал показывать картинку с камеры прямо в Home.app, Alexa показала, что она охранная система (то есть режим Guard), а NetAtmo сдала все свои датчики по отдельности. Единственное, с чем я еще не разобрался, это Amazon Smart Plug — там предлагается эмулировать его сразу двумя плагинами, включая виртуальный контакт и вот последний не обнаруживается самой Alexa. Ну, разберемся.<figure class="wp-block-image size-large is-style-default">

[<img data-attachment-id="60123" data-permalink="https://blognot.co/60121/img_bb9513004176-1" data-orig-file="https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?fit=2388%2C1668&ssl=1" data-orig-size="2388,1668" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="IMG_BB9513004176-1" data-image-description="" data-medium-file="https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?fit=300%2C210&ssl=1" data-large-file="https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?fit=740%2C517&ssl=1" width="740" height="517" src="https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=740%2C517&#038;ssl=1" alt="" class="wp-image-60123" srcset="https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=1024%2C715&ssl=1 1024w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=300%2C210&ssl=1 300w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=768%2C536&ssl=1 768w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=1536%2C1073&ssl=1 1536w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=2048%2C1431&ssl=1 2048w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?resize=800%2C559&ssl=1 800w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?w=1480&ssl=1 1480w, https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?w=2220&ssl=1 2220w" sizes="(max-width: 740px) 100vw, 740px" data-recalc-dims="1" />][2]</figure> 

Теперь можно подбирать девайсы без оглядки на то, с чем они конкретно работают. И, в принципе, можно уже и про термостат подумать, наверное. А то мороз, знаете ли, вон то 10,5 в кружке — это на самом деле минус 10,5 на уличном датчике.

 [1]: https://i0.wp.com/blognot.co/wp-content/uploads/2021/01/Homebridge-315F-2021-01-17-11-10-11.png?ssl=1
 [2]: https://i2.wp.com/blognot.co/wp-content/uploads/2021/01/IMG_BB9513004176-1.jpeg?ssl=1