---
title: Потратил энное количество времени на
author: Gray
type: posts
date: 2004-02-05T02:47:28+00:00
excerpt:
url: /4565
dsq_thread_id:
  - 2829093981
esml_socialcount_LAST_UPDATED:
  - 1497199323
essb_cache_expire:
  - 1614508846
categories:
  - Uncategorized

---







Потратил энное количество времени на перестройку почты. Похоже, что Spampal мне больше не понадобится.  
Дело вот в чем. Последняя эпидемия MyDoom показала половинчатость использования фильтрации на локальных машинах. Да, благодаря тому, что вся входящая почта у меня пропускается через Spampal и проверяется антивирусом, никаких последствий от вируса не возникло и папка &#171;Входящие&#187; в почтовых аккаунтах осталась чиста. Но при этом, пока я не настроил блокировку приема сообщений более 30 килобайт в Бате, почта жрала трафик как КАМАз &#8212; солярку. Простая арифметика &#8212; в сутки сваливалось порядка 300 писем с вирусом, каждое &#8212; весом в 32-34 килобайта &#8212; итого 10 мегабайт в сутки уходило только на вирус. Да плюс отлупы от чужих серверов, да плюс обычный спам. На пике мне пришло только на основной рабочий адрес 1047 писем в сутки. Весело, не правда ли?  
Посмотрел я на это и начал придумывать варианты. Вариант установки антивируса на сервере отпал по двум причинам:  
1. Хороший антивирус стоит денег. Мне, вообще говоря, не жалко, но есть варианты бесплатные в принципе.  
2. Конфигурация конкретного сервера, на котором бегает сайт и вся почта, такова, что так просто стандартно установленный sendmail со своего места не спихнешь. Что приводит к жутким сложностям в настройке и последующей эксплуатации.  
Решено было воспользоваться <a href="http://so.yandex.ru/" target="_blank">&#171;Спамообороной&#187;</a> Яндекса. В качестве вариантов рассматривались также:  
1. Почта Яндекса.  
2. Почта на mail.ru  
3. SpamTest.ru  
Почта Яндекса и mail.ru отпали из-за сложности решения. Поскольку это все же полнофункциональные почтовые сервисы, для разметки спама и вирусов в них надо сделать определенные движения, настроить фильтры и т.д. Спамтест отпал по другим соображениям &#8212; я так и не понял, умеет ли он убивать вирусы или только спамом занимается, и не нашел, как настроить не разметку писем, а их удаление.  
Вот что получилось со &#171;Спамообороной&#187;. Ограничения сервиса позволяют пропустить через один аккаунт до 1000 писем в сутки. Почти хватит на любую эпидемию. Впрочем, в принципе, реально завести несколько аккаунтов и крутить их кроном по кругу. Далее на своем сервере я сделал абсолютно новый адрес &#8212; с длинным и незапоминающимся именем, для исключения возможности подобрать его по словарю. Не хватало еще, чтобы на него сам по себе спам начал идти.  
Дальше настраиваются параметры &#171;Спамообороны&#187; &#8212; куда пересылать и как помечать распознанные письма. Последний штрих &#8212; на почтовом аккаунте ставится форвардинг (если есть доступ в юниксовую папку, где лежит почта, то для этого достаточно положить файл .forward, в котором будет указан адрес, куда отправлять письма). Я поставил форвард на два адреса &#8212; &#171;Спамооборону&#187; и сам исходный ящик. &#171;Спамооборона&#187; же настроена так, чтобы убивать все подозрительное. По моему опыту, пометка спама &#8212; это еще один паллиатив, который приводит к том, что спам все равно просматривается почти так же часто, как и чистая почта. Поэтому отфильтрованная почта будет проверяться регулярно, а раз в несколько дней можно будет и проверить заголовки в исходном ящике.  
Пока результаты оценивать рано. Через несколько дней можно будет оценить эффективность подобного решения.  
Для желающих так же очистить почту, но не имеющих возможности настройки форвардинга самостоятельно, рекомендую воспользоваться иной схемой. Почта и на Яндексе, и на mail.ru позволяет собирать почту с других серверов. При этом к такой почте применяются фильтры и прочее. Настройте сбор почты и дальше решайте &#8212; пересылать ее еще куда-то или проверять прямо на сервисе, благо оба дают доступ по pop3.  
Мне такая схема не подошла потому, что можно сделать удобнее. Кроме того, сбор почты делается раз в час, как минимум, а мне надо чаще.  
Вообще-то, есть мысли еще поиграться, но там будет видно&#8230;